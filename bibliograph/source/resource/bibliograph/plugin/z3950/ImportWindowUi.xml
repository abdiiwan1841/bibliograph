<?xml version="1.0" encoding="utf-8"?>
<qxt:component
  xmlns:qx="http://www.qxtransformer.org/qooxdoo/0.8"
  xmlns:qxt="http://www.qxtransformer.org/extension/0.4"
  xmlns:qcl="http://www.qooxdoo.org/contrib/qcl/trunk"
  author="Christian Boulanger"
  className="bibliograph.plugin.z3950.ImportWindowUi"
  extend="bibliograph.plugin.z3950.ImportWindow"> 
  
  <qx:window
    id="importWindow"
    caption="{js}this.tr('Import from library catalogue')"
    visibility="excluded"
    showMinimize="false"
    width="700" height="500">
    
    <qxt:subscriber name="logout">importWindow.close()</qxt:subscriber>
    <qxt:listener type="appear">importWindow.center();</qxt:listener>
    
    <qx:vbox spacing="5">
    
      <!-- toolbar -->
      <qx:toolBar>
      
        <qx:selectBox 
          id="datasourceSelectBox" qxt:scope="this"
          width="150" maxHeight="25">
          <qx:listItem label="{js}this.tr('GBV Katalog')" />
        </qx:selectBox>
        
        <qx:spacer qxt:flex="1"/>
        
        <!-- search box -->     
        <qx:composite 
           qxt:flex="1"
           padding="4">
          <qx:hbox >
           <qx:textField
              id="searchBox" qxt:scope="this"
              qxt:flex="1"
              placeholder="{js}this.tr('Enter search term')" 
              height="26" padding="2">
              <qxt:listener type="keypress" delegate="_on_keypress" />
              <qxt:listener type="dblclick">
                 e.stopPropagation();
              </qxt:listener>          
            </qx:textField>
          </qx:hbox>
        </qx:composite>
        
      </qx:toolBar>  
    
      <!-- list view -->
      <qx:widget 
        id="listView" qxt:scope="this"
        qxt:class="bibliograph.ui.reference.ListView" 
        qxt:flex="1"
        decorator="main"
        datasource="z3950_gbv"
        serviceName="bibliograph.plugin.z3950.Service"
        modelType="record"
      />
      
<!--      <qcl:access>-->
<!--        <qcl:permission name="allowImport" grant="true">-->
<!--        <qcl:dependency permission="reference.import" />-->
<!--          <qcl:updater applicationEvent="changeFolderId" />-->
<!--          <qcl:updater event="changeSelectedIds" target="this.listView"/>-->
<!--          <qcl:condition><![CDATA[-->
<!--            return ( -->
<!--              ( this.getApplication().getFolderId() > 0 ) &&-->
<!--              ( this.listView.getSelectedIds().count > 0 )-->
<!--            );-->
<!--          ]]></qcl:condition>-->
<!--        </qcl:permission>-->
<!--      </qcl:access>      -->

      <!-- buttons -->        
      <qx:composite>
        <qx:hbox spacing="5">
        
           <qx:label id="statusTextLabel">
            <qxt:observe 
              propertyChain="value" 
              source="this.listView"
              sourcePropertyChain="store.model.statusText" />
           </qx:label>
          
           <qx:spacer qxt:flex="10" />
           
           <qx:button 
             label="{js}this.tr('Import selected records')"
             enabled="false"
             id="importButton" qxt:scope="this">
            <qxt:listener type="execute">this.importSelected()</qxt:listener>
           </qx:button>
           
           <qx:button label="{js}this.tr('Close')">
            <qxt:listener type="execute">this.close()</qxt:listener>
           </qx:button>
           
        </qx:hbox>
      </qx:composite>
        
    </qx:vbox>
    
  </qx:window>
</qxt:component>